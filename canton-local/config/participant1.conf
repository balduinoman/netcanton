canton {
  features {
    enable-preview-commands = yes
    enable-testing-commands = yes
  }

  parameters {
    manual-start = no
    non-standard-config = yes
    timeouts.processing.verify-active = 40.seconds
    timeouts.processing.slow-future-warn = 20.seconds
  }

  monitoring.logging.delay-logging-threshold = 40.seconds

  participants {
    participant1 {
      init {
        generate-topology-transactions-and-keys = true
      }

      # Ledger API
      ledger-api {
        address = "0.0.0.0"
        port = 5001
        max-token-lifetime = Inf
        admin-token-config.admin-claim = true
        user-management-service.additional-admin-user-id = "participant1"

        command-service {
          max-commands-in-flight = 30
        }

        index-service {
          max-contract-state-cache-size = 1000
          max-contract-key-state-cache-size = 1000
          max-transactions-in-memory-fan-out-buffer-size = 200
        }

        # Disable auth for testing
        auth-services = []
      }

      # Admin API (optional)
      admin-api {
        address = "0.0.0.0"
        port = 5002
      }

      # HTTP Ledger API
      http-ledger-api {
        address = "0.0.0.0"
        port = 7575
        path-prefix = "participant1"
      }

      # Health service (gRPC)
      monitoring.grpc-health-server {
        address = "0.0.0.0"
        port = 5061
      }

      # Storage
      storage {
        type = postgres
        config {
          url = "jdbc:postgresql://postgres-participant1:5432/canton"
          user = "canton"
          password = "canton"
        }
      }

      sequencer-client {
        acknowledgement-interval = 10m
        maximum-in-flight-event-batches = 50
        use-new-connection-pool = true
        enable-amplification-improvements = true
      }

      parameters {
        initial-protocol-version = 34
      }

      topology {
        broadcast-batch-size = 1
        validate-initial-topology-snapshot = false
      }
    }
  }
}